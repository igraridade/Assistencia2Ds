<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>{% block title %}IGECH TECH{% endblock %}</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='css/global.css', v=1) }}"/>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/alerts.css') }}">

  {% block page_css %}{% endblock %}
</head>

<body>

<div id="particles-bg" aria-hidden="true"></div>

<header>
  <div class="logo">
    <a href="{{ url_for('home') }}" class="brand">IGECH <span class="accent">TECH</span></a>
  </div>

  <nav class="site-nav">
    <button class="hamburger" id="hamburger" aria-label="Abrir menu" aria-expanded="false" aria-controls="mainMenu">
      <span></span><span></span><span></span>
    </button>
<ul id="mainMenu" class="menu">
  {% if session.get('admin') %}
    <li><a href="{{ url_for('dashboard') }}">Dashboard</a></li>
    <li><a href="{{ url_for('empresas') }}">Empresas</a></li>
    <li><a href="{{ url_for('tecnicos') }}">T√©cnicos</a></li>
    <li><a href="{{ url_for('usuarios') }}">Usu√°rios</a></li>
    <li><a href="{{ url_for('alocacoes') }}">Aloca√ß√µes</a></li>
    <li><a href="{{ url_for('servicos') }}">Servi√ßos</a></li>
  {% elif session.get('usuario_id') %}
    <li><a href="{{ url_for('contratar_servico') }}" class="menu-destaque">üõ†Ô∏è Contratar Servi√ßo</a></li>
    <li><a href="{{ url_for('servicos') }}">Meus Servi√ßos</a></li>
  {% else %}
    <li><a href="{{ url_for('contratar_servico') }}" class="menu-destaque">üõ†Ô∏è Contratar Servi√ßo</a></li>
  {% endif %}

  <li><a href="{{ url_for('sobre_nos') }}">Sobre N√≥s</a></li> <!-- ‚úÖ ADICIONAR AQUI -->
  <li><a href="{{ url_for('ajuda') }}">Ajuda</a></li>
</ul>

  </nav>

  <div class="top-user">
    {% if not session.get('usuario_id') %}
      <button id="btnLogin" class="btn" type="button" data-open="modalLogin">Login</button>
      <button id="btnCadastro" class="btn" type="button" data-open="modalCadastro">Cadastro</button>
    {% else %}
      <span class="user-name">{{ session.get('usuario_nome') }}</span>
      <a href="{{ url_for('logout') }}" id="btnLogout" class="btn-link">Sair</a>
    {% endif %}
  </div>
</header>

<main id="main" class="main">
  <div class="flash-messages">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }}">
            <span class="alert-icon">
              {% if category == 'success' %}‚úì{% endif %}
              {% if category == 'danger' or category == 'error' %}‚úó{% endif %}
              {% if category == 'warning' %}‚ö†{% endif %}
              {% if category == 'info' %}‚Ñπ{% endif %}
            </span>
            <span class="alert-message">{{ message }}</span>
            <button class="alert-close">&times;</button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}
  </div>

  {% block content %}{% endblock %}
</main>

<footer>
  <p>2025 IGECH TECH ‚Äî Todos os direitos reservados.</p>
</footer>

<!-- Modal Login -->
<div id="modalLogin" class="modal" aria-hidden="true">
  <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="loginTitle" aria-describedby="loginDesc">
    <button type="button" class="close" id="closeLogin" aria-label="Fechar">&times;</button>
    <h2 id="loginTitle">Login</h2>
    <p id="loginDesc" class="sr-only">Entre com seu e-mail e senha para acessar o sistema.</p>
    <form method="POST" action="{{ url_for('login') }}">
      <label for="login_email">Email</label>
      <input type="email" id="login_email" name="email" required autocomplete="username"/>

      <label for="login_senha">Senha</label>
      <input type="password" id="login_senha" name="senha" required autocomplete="current-password"/>

      <button type="submit" class="btn">Entrar</button>

      <p class="modal-switch">
        N√£o tem conta?
        <button type="button" class="btn-link" data-switch="modalCadastro">Criar conta</button>
      </p>
    </form>
  </div>
</div>

<!-- Modal Cadastro -->
<div id="modalCadastro" class="modal" aria-hidden="true">
  <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="cadastroTitle" aria-describedby="cadastroDesc">
    <button type="button" class="close" id="closeCadastro" aria-label="Fechar">&times;</button>
    <h2 id="cadastroTitle">Cadastro de Usu√°rio</h2>
    <p id="cadastroDesc" class="sr-only">Informe seus dados pessoais e da empresa onde trabalha.</p>
    <form method="POST" action="{{ url_for('usuario.api_usuario_criar') }}" id="formCadastro">


      <!-- Dados Pessoais -->
      <fieldset style="border: none; padding: 0; margin-bottom: 20px;">
        <legend style="font-weight: bold; margin-bottom: 10px;">üìã Dados Pessoais</legend>
        <label for="cadastro_nome">Nome Completo *</label>
        <input type="text" id="cadastro_nome" name="nome" required placeholder="Ex: Jo√£o Silva"/>
        <label for="cadastro_email">Email *</label>
        <input type="email" id="cadastro_email" name="email" required autocomplete="email" placeholder="seu@email.com"/>
        <label for="cadastro_senha">Senha *</label>
        <input type="password" id="cadastro_senha" name="senha" required autocomplete="new-password" minlength="6" placeholder="M√≠nimo 6 caracteres"/>
        <label for="cadastro_telefone">Telefone *</label>
        <input type="tel" id="cadastro_telefone" name="telefone" required placeholder="(11) 98765-4321"/>
      </fieldset>

      <!-- Dados da Empresa -->
      <fieldset style="border: none; padding: 0; margin-bottom: 20px;">
        <legend style="font-weight: bold; margin-bottom: 10px;">üè¢ Empresa onde Trabalha</legend>
        <label for="cadastro_empresa_cnpj">CNPJ da Empresa *</label>
        <input type="text"
               id="cadastro_empresa_cnpj"
               name="empresa_cnpj"
               required
               maxlength="18"
               placeholder="00.000.000/0000-00"/>
        <small style="display: block; color: #666; font-size: 0.85rem; margin-top: 4px;">
          Informe o CNPJ da empresa onde voc√™ trabalha
        </small>
        <div id="cnpj_status" style="margin-top: 8px; font-size: 0.9rem;"></div>

        <!-- √Årea para mostrar dados da empresa (API CNPJ√°) -->
        <div id="dados_empresa_encontrada" style="display: none; margin-top: 15px; padding: 15px; background: #f0fdf4; border-left: 4px solid #10b981; border-radius: 8px;">
          <h4 style="margin: 0 0 10px 0; color: #10b981; font-size: 0.95rem;">‚úÖ Dados da Empresa (CNPJ√°)</h4>
          <div id="empresa_info" style="font-size: 0.85rem; line-height: 1.6;"></div>
        </div>

        <!-- Email manual se a API n√£o retornar -->
        <div id="campo_email_empresa" style="display:none; margin-top:12px;">
          <label for="input_email_empresa">Email da Empresa *</label>
          <input type="email" id="input_email_empresa" name="empresa_email_manual" placeholder="contato@empresa.com.br"/>
          <small style="display:block;font-size:0.9em;color:#666;">Se n√£o houver email oficial na Receita</small>
        </div>

        <div id="campo_nome_empresa" style="display: none; margin-top: 15px;">
          <label for="cadastro_empresa_nome">Nome da Empresa *</label>
          <input type="text"
                 id="cadastro_empresa_nome"
                 name="empresa_nome"
                 placeholder="Ex: Google Brasil Ltda"/>
          <small style="display: block; color: #666; font-size: 0.85rem; margin-top: 4px;">
            Informe o nome da empresa
          </small>
        </div>
      </fieldset>

      <button type="submit" class="btn">Registrar</button>
      <p class="modal-switch">
        J√° tem conta?
        <button type="button" class="btn-link" data-switch="modalLogin">Entrar</button>
      </p>
    </form>
  </div>
</div>

<!-- MODAL DE PENDENTES (para admin na tela de usu√°rios) -->
<div id="modalPendentes" class="modal" aria-hidden="true">
  <div class="modal-content" style="max-width:500px;">
    <div class="modal-header">
      <h2>Usu√°rios Pendentes de Aprova√ß√£o</h2>
      <button type="button" class="close" onclick="closeModalPendentes()" aria-label="Fechar">&times;</button>
    </div>
    <div class="modal-body" id="pendentesList">
      <!-- Conte√∫do via JS -->
    </div>
  </div>
</div>


<script src="https://bots.easy-peasy.ai/chat.min.js" data-chat-url="https://bots.easy-peasy.ai/bot/8a13ab86-bb82-4ce8-96c5-81f5d57e1481" data-btn-position="bottom-right" data-widget-btn-color="#3b8cff" defer> </script>

<script src="{{ url_for('static', filename='js/alerts.js', v=2) }}"></script>
<script src="{{ url_for('static', filename='js/modals.js', v=3) }}"></script>

{% block page_js %}{% endblock %}

</body>
</html>
